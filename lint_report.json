
> sprite-scavenger@0.1.0 lint
> eslint -f json

[{"filePath":"C:\\spritescavenger\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\app\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\spritescavenger\\src\\app\\page.tsx:23:5\n  21 |\n  22 |   useEffect(() => {\n> 23 |     setMounted(true);\n     |     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  24 |   }, []);\n  25 |\n  26 |   // Keyboard Shortcuts","line":23,"column":5,"nodeType":null,"endLine":23,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport Header from \"@/components/Header\";\nimport SettingsModal from \"@/components/SettingsModal\";\nimport { useGame } from \"@/context/GameContext\";\nimport ExpeditionView from \"@/views/ExpeditionView\";\nimport CollectionView from \"@/views/CollectionView\";\nimport ForgeView from \"@/views/ForgeView\";\nimport LabView from \"@/views/LabView\";\nimport CommandPalette from \"@/components/CommandPalette\";\nimport { Terminal, Cpu, Hammer, Database } from \"lucide-react\";\n\nexport default function Home() {\n  const { isLoading } = useGame();\n\n  const [activeTab, setActiveTab] = useState('terminal');\n  const [settingsOpen, setSettingsOpen] = useState(false);\n  const [commandOpen, setCommandOpen] = useState(false);\n  const [mounted, setMounted] = useState(false);\n\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  // Keyboard Shortcuts\n  useEffect(() => {\n    const handleGlobalKeyDown = (e: KeyboardEvent) => {\n      // Toggle Command Palette: Ctrl+K or Cmd+K\n      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {\n        e.preventDefault();\n        setCommandOpen(prev => !prev);\n      }\n\n      // Close on Escape\n      if (e.key === 'Escape') {\n        if (commandOpen) setCommandOpen(false);\n        if (settingsOpen) setSettingsOpen(false);\n      }\n\n      // Ignore other shortcuts if inputs or modals are open\n      if (commandOpen || settingsOpen) return;\n\n      // Tab Switching\n      if (e.key === '1') setActiveTab('terminal');\n      if (e.key === '2') setActiveTab('lab');\n      if (e.key === '3') setActiveTab('forge');\n      if (e.key === '4') setActiveTab('database');\n    };\n\n    window.addEventListener('keydown', handleGlobalKeyDown);\n    return () => window.removeEventListener('keydown', handleGlobalKeyDown);\n  }, [commandOpen, settingsOpen]);\n\n  const handleNav = (tab?: string) => {\n    if (tab === 'settings') {\n      setSettingsOpen(true);\n    } else if (tab) {\n      setActiveTab(tab);\n    }\n  };\n\n  if (!mounted || isLoading) {\n    return (\n      <div className=\"min-h-screen bg-slate-950 flex items-center justify-center\">\n        <span className=\"text-emerald-500 font-mono animate-pulse\">INITIALIZING SYSTEM...</span>\n      </div>\n    );\n  }\n\n  return (\n    <main className=\"min-h-screen bg-slate-950 pt-20 pb-0 overflow-x-hidden\">\n      <Header onSettingsClick={handleNav} activeTab={activeTab} />\n\n      <div className=\"w-full\">\n        {activeTab === 'terminal' && <ExpeditionView />}\n        {activeTab === 'lab' && <LabView />}\n        {activeTab === 'forge' && <ForgeView />}\n        {activeTab === 'database' && <CollectionView />}\n      </div>\n\n      <SettingsModal isOpen={settingsOpen} onClose={() => setSettingsOpen(false)} />\n      <CommandPalette\n        isOpen={commandOpen}\n        onClose={() => setCommandOpen(false)}\n        onNavigate={(tab) => {\n          setActiveTab(tab);\n        }}\n      />\n\n      {/* Mobile Nav Bar - Fixed Bottom */}\n      <div className=\"md:hidden fixed bottom-0 left-0 right-0 bg-slate-900 border-t border-slate-800 p-2 flex justify-around z-50 pb-safe\">\n        <button\n          onClick={() => setActiveTab('terminal')}\n          className={`flex flex-col items-center p-2 rounded w-16 ${activeTab === 'terminal' ? 'text-indigo-400' : 'text-slate-500'}`}\n        >\n          <Terminal className=\"w-5 h-5 mb-1\" />\n          <span className=\"text-[9px] font-bold\">TERM</span>\n        </button>\n        <button\n          onClick={() => setActiveTab('lab')}\n          className={`flex flex-col items-center p-2 rounded w-16 ${activeTab === 'lab' ? 'text-indigo-400' : 'text-slate-500'}`}\n        >\n          <Cpu className=\"w-5 h-5 mb-1\" />\n          <span className=\"text-[9px] font-bold\">LAB</span>\n        </button>\n        <button\n          onClick={() => setActiveTab('forge')}\n          className={`flex flex-col items-center p-2 rounded w-16 ${activeTab === 'forge' ? 'text-indigo-400' : 'text-slate-500'}`}\n        >\n          <Hammer className=\"w-5 h-5 mb-1\" />\n          <span className=\"text-[9px] font-bold\">FORGE</span>\n        </button>\n        <button\n          onClick={() => setActiveTab('database')}\n          className={`flex flex-col items-center p-2 rounded w-16 ${activeTab === 'database' ? 'text-indigo-400' : 'text-slate-500'}`}\n        >\n          <Database className=\"w-5 h-5 mb-1\" />\n          <span className=\"text-[9px] font-bold\">DB</span>\n        </button>\n      </div>\n    </main>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\components\\BiomeSelector.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[254,257],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[254,257],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useGame } from \"@/context/GameContext\";\r\nimport { BIOMES } from \"@/data/biomes\";\r\nimport { Lock, Map as MapIcon, Utensils, Trees, Hammer, ShoppingBag } from \"lucide-react\";\r\nimport { motion } from \"framer-motion\";\r\n\r\nconst ICONS: Record<string, any> = {\r\n    Map: MapIcon,\r\n    Utensils: Utensils,\r\n    Trees: Trees,\r\n    Hammer: Hammer,\r\n    ShoppingBag: ShoppingBag\r\n};\r\n\r\nexport default function BiomeSelector() {\r\n    const { unlockedBiomes, activeBiome, bits, unlockBiome, setActiveBiome } = useGame();\r\n\r\n    return (\r\n        <div className=\"w-full max-w-4xl mx-auto px-4 mb-4\">\r\n            <div className=\"flex gap-4 overflow-x-auto pb-4 scrollbar-hide snap-x\">\r\n                {BIOMES.map((biome) => {\r\n                    const isUnlocked = unlockedBiomes.includes(biome.id);\r\n                    const isActive = activeBiome === biome.id;\r\n                    const canAfford = bits >= biome.cost;\r\n                    const Icon = ICONS[biome.icon] || MapIcon;\r\n\r\n                    return (\r\n                        <motion.div\r\n                            key={biome.id}\r\n                            layoutId={biome.id}\r\n                            className={`\r\n                        relative shrink-0 w-48 h-64 rounded-xl border-2 p-4 flex flex-col justify-between\r\n                        transition-all duration-300 snap-center\r\n                        ${isActive ? `bg-${biome.color} border-${biome.color} ring-4 ring-${biome.color}/30 scale-105` : ''}\r\n                        ${!isActive && isUnlocked ? 'bg-slate-800 border-slate-700 hover:border-slate-500 cursor-pointer' : ''}\r\n                        ${!isUnlocked ? 'bg-slate-900 border-slate-800 opacity-70 grayscale' : ''}\r\n                    `}\r\n                            onClick={() => {\r\n                                if (isUnlocked && !isActive) setActiveBiome(biome.id);\r\n                            }}\r\n                        >\r\n                            <div className=\"flex justify-between items-start\">\r\n                                <div className={`p-2 rounded-lg ${isActive ? 'bg-black/20 text-white' : 'bg-slate-900 text-slate-400'}`}>\r\n                                    <Icon className=\"w-6 h-6\" />\r\n                                </div>\r\n                                {isActive && <div className=\"bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold text-white\">ACTIVE</div>}\r\n                                {!isUnlocked && <Lock className=\"w-5 h-5 text-slate-600\" />}\r\n                            </div>\r\n\r\n                            <div>\r\n                                <h3 className={`font-bold text-lg mb-1 ${isActive ? 'text-white' : 'text-slate-200'}`}>\r\n                                    {biome.name}\r\n                                </h3>\r\n                                <p className={`text-xs leading-tight ${isActive ? 'text-white/80' : 'text-slate-500'}`}>\r\n                                    {biome.description}\r\n                                </p>\r\n                            </div>\r\n\r\n                            {!isUnlocked && (\r\n                                <button\r\n                                    onClick={(e) => {\r\n                                        e.stopPropagation();\r\n                                        unlockBiome(biome.id, biome.cost);\r\n                                    }}\r\n                                    disabled={!canAfford}\r\n                                    className={`\r\n                                w-full mt-2 py-2 rounded font-bold text-xs flex items-center justify-center gap-1\r\n                                ${canAfford\r\n                                            ? 'bg-emerald-600 hover:bg-emerald-500 text-white shadow-lg'\r\n                                            : 'bg-slate-800 text-slate-500 cursor-not-allowed'\r\n                                        }\r\n                            `}\r\n                                >\r\n                                    UNLOCK {biome.cost}\r\n                                </button>\r\n                            )}\r\n                        </motion.div>\r\n                    );\r\n                })}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\components\\CollectionGrid.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\r\nimport Image from \"next/image\";\r\nimport { useGame } from \"@/context/GameContext\";\r\nimport masterCollection from \"@/data/master-collection.json\";\r\nimport { Lock } from \"lucide-react\";\r\nimport { getRarity } from \"@/utils/rarity\";\r\n\r\nexport default function CollectionGrid() {\r\n    const { inventory } = useGame();\r\n    const categories = Object.keys(masterCollection);\r\n\r\n    return (\r\n        <div className=\"w-full max-w-6xl mx-auto p-4 pb-32 flex flex-col gap-6\">\r\n            {categories.map((cat) => (\r\n                <div key={cat} className=\"flex bg-slate-900/50 rounded-xl border border-slate-800 overflow-hidden min-h-[150px]\">\r\n                    {/* Left: Category Label */}\r\n                    <div className=\"w-12 bg-slate-800 border-r border-slate-700 flex items-center justify-center shrink-0\">\r\n                        <span\r\n                            className=\"text-xs font-bold uppercase tracking-widest text-slate-400 whitespace-nowrap\"\r\n                            style={{ writingMode: 'vertical-rl', transform: 'rotate(180deg)' }}\r\n                        >\r\n                            {cat}\r\n                        </span>\r\n                    </div>\r\n\r\n                    {/* Right: Grid */}\r\n                    <div className=\"p-4 flex-1\">\r\n                        <div className=\"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-3\">\r\n                            {/* @ts-expect-error JSON typing */}\r\n                            {masterCollection[cat]?.map((slug: string) => {\r\n                                const isOwned = inventory.includes(slug);\r\n                                const rarity = getRarity(slug);\r\n\r\n                                return (\r\n                                    <div\r\n                                        key={slug}\r\n                                        className={`\r\n                                            aspect-square rounded border flex items-center justify-center relative group\r\n                                            transition-colors\r\n                                            ${isOwned\r\n                                                ? `bg-slate-800 border-slate-700`\r\n                                                : 'bg-slate-900 border-slate-800'\r\n                                            }\r\n                                        `}\r\n                                        style={isOwned ? { borderColor: rarity.hex } : {}}\r\n                                    >\r\n                                        {isOwned ? (\r\n                                            <>\r\n                                                <div className=\"w-full h-full p-2 relative\">\r\n                                                    <Image\r\n                                                        src={`/icons/${cat}/${slug}.png`}\r\n                                                        alt={slug}\r\n                                                        fill\r\n                                                        className=\"object-contain pixelated rendering-pixelated\"\r\n                                                        sizes=\"100px\"\r\n                                                    />\r\n                                                </div>\r\n                                                {/* Tooltip */}\r\n                                                <div className=\"absolute inset-0 bg-slate-900/90 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center rounded p-1 z-10 pointer-events-none\">\r\n                                                    <span\r\n                                                        className=\"text-[8px] font-mono text-center px-1 break-all font-bold mb-1 leading-tight\"\r\n                                                        style={{ color: rarity.hex }}\r\n                                                    >\r\n                                                        {slug.split('-').pop()}\r\n                                                    </span>\r\n                                                </div>\r\n                                            </>\r\n                                        ) : (\r\n                                            <Lock className=\"w-4 h-4 text-slate-800\" />\r\n                                        )}\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            ))}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\components\\CommandPalette.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used.","line":2,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":39},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`results` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\spritescavenger\\src\\components\\CommandPalette.tsx:38:61\n  36 |             if (e.key === \"ArrowDown\") {\n  37 |                 e.preventDefault();\n> 38 |                 setSelectedIndex(prev => Math.min(prev + 1, results.length - 1));\n     |                                                             ^^^^^^^ `results` accessed before it is declared\n  39 |             }\n  40 |             if (e.key === \"ArrowUp\") {\n  41 |                 e.preventDefault();\n\nC:\\spritescavenger\\src\\components\\CommandPalette.tsx:81:5\n  79 |\n  80 |     // Filter\n> 81 |     const results = [\n     |     ^^^^^^^^^^^^^^^^^\n> 82 |         ...navCommands.filter(c => c.label.toLowerCase().includes(query.toLowerCase())),\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 83 |         ...allItems.filter(i => i.label.toLowerCase().includes(query.toLowerCase()) || i.value.toLowerCase().includes(query.toLowerCase()))\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 84 |     ].slice(0, 10); // Limit to 10\n     | ^^^^^^^^^^^^^^^^^^^^ `results` is declared here\n  85 |\n  86 |     const handleSelect = (item: any) => {\n  87 |         if (item.type === 'NAV') {","line":38,"column":61,"nodeType":null,"endLine":38,"endColumn":68},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`handleSelect` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\spritescavenger\\src\\components\\CommandPalette.tsx:47:21\n  45 |                 e.preventDefault();\n  46 |                 if (results[selectedIndex]) {\n> 47 |                     handleSelect(results[selectedIndex]);\n     |                     ^^^^^^^^^^^^ `handleSelect` accessed before it is declared\n  48 |                 }\n  49 |             }\n  50 |         };\n\nC:\\spritescavenger\\src\\components\\CommandPalette.tsx:86:5\n  84 |     ].slice(0, 10); // Limit to 10\n  85 |\n> 86 |     const handleSelect = (item: any) => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 87 |         if (item.type === 'NAV') {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 88 |             onNavigate(item.value);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 89 |         } else if (item.type === 'ITEM') {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 90 |             // Ideally jump to database and highlight? \n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 91 |             // For now, just go to database\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 92 |             onNavigate('database');\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 93 |         }\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 94 |         onClose();\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 95 |     };\n     | ^^^^^^^ `handleSelect` is declared here\n  96 |\n  97 |     if (!isOpen) return null;\n  98 |","line":47,"column":21,"nodeType":null,"endLine":47,"endColumn":33},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'handleSelect', 'onClose', 'results', and 'selectedIndex'. Either include them or remove the dependency array. If 'onClose' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":54,"column":8,"nodeType":"ArrayExpression","endLine":54,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [handleSelect, isOpen, onClose, results, selectedIndex]","fix":{"range":[1895,1903],"text":"[handleSelect, isOpen, onClose, results, selectedIndex]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3292,3295],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3292,3295],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from \"react\";\r\nimport { Search, Hash, ArrowRight, Zap, Database, Hammer, Cpu, Terminal } from \"lucide-react\";\r\nimport { useGame } from \"@/context/GameContext\";\r\nimport masterCollection from \"@/data/master-collection.json\";\r\nimport { getRarity } from \"@/utils/rarity\";\r\n\r\ninterface CommandPaletteProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onNavigate: (tab: string) => void;\r\n}\r\n\r\nexport default function CommandPalette({ isOpen, onClose, onNavigate }: CommandPaletteProps) {\r\n    const { inventory } = useGame();\r\n    const [query, setQuery] = useState(\"\");\r\n    const inputRef = useRef<HTMLInputElement>(null);\r\n    const [selectedIndex, setSelectedIndex] = useState(0);\r\n\r\n    // Auto-focus input when opened\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            setQuery(\"\");\r\n            setSelectedIndex(0);\r\n            setTimeout(() => inputRef.current?.focus(), 50);\r\n        }\r\n    }, [isOpen]);\r\n\r\n    // Handle Closing\r\n    useEffect(() => {\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            if (!isOpen) return;\r\n\r\n            if (e.key === \"Escape\") {\r\n                onClose();\r\n            }\r\n            if (e.key === \"ArrowDown\") {\r\n                e.preventDefault();\r\n                setSelectedIndex(prev => Math.min(prev + 1, results.length - 1));\r\n            }\r\n            if (e.key === \"ArrowUp\") {\r\n                e.preventDefault();\r\n                setSelectedIndex(prev => Math.max(prev - 1, 0));\r\n            }\r\n            if (e.key === \"Enter\") {\r\n                e.preventDefault();\r\n                if (results[selectedIndex]) {\r\n                    handleSelect(results[selectedIndex]);\r\n                }\r\n            }\r\n        };\r\n\r\n        window.addEventListener(\"keydown\", handleKeyDown);\r\n        return () => window.removeEventListener(\"keydown\", handleKeyDown);\r\n    }, [isOpen]); // Dependency on results is tricky here, simplification: ignore strict result dep for index cap for now or move logic\r\n\r\n    // --- Search Logic ---\r\n    // 1. Navigation Commands\r\n    const navCommands = [\r\n        { id: 'nav-term', label: 'Go to Terminal', type: 'NAV', value: 'terminal', icon: Terminal },\r\n        { id: 'nav-lab', label: 'Go to Lab', type: 'NAV', value: 'lab', icon: Cpu },\r\n        { id: 'nav-forge', label: 'Go to Forge', type: 'NAV', value: 'forge', icon: Hammer },\r\n        { id: 'nav-db', label: 'Go to Database', type: 'NAV', value: 'database', icon: Database },\r\n    ];\r\n\r\n    // 2. Item Search\r\n    // Flatten master collection\r\n    const allItems = Object.entries(masterCollection).flatMap(([cat, slugs]) =>\r\n        slugs.map(slug => ({\r\n            id: slug,\r\n            label: slug.split('-').pop() || slug,\r\n            type: 'ITEM',\r\n            value: slug,\r\n            cat,\r\n            icon: Hash,\r\n            isOwned: inventory.includes(slug),\r\n            rarity: getRarity(slug)\r\n        }))\r\n    );\r\n\r\n    // Filter\r\n    const results = [\r\n        ...navCommands.filter(c => c.label.toLowerCase().includes(query.toLowerCase())),\r\n        ...allItems.filter(i => i.label.toLowerCase().includes(query.toLowerCase()) || i.value.toLowerCase().includes(query.toLowerCase()))\r\n    ].slice(0, 10); // Limit to 10\r\n\r\n    const handleSelect = (item: any) => {\r\n        if (item.type === 'NAV') {\r\n            onNavigate(item.value);\r\n        } else if (item.type === 'ITEM') {\r\n            // Ideally jump to database and highlight? \r\n            // For now, just go to database\r\n            onNavigate('database');\r\n        }\r\n        onClose();\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[100] flex items-start justify-center pt-[20vh] px-4\">\r\n            <div className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\" onClick={onClose} />\r\n\r\n            <div className=\"w-full max-w-lg bg-slate-900 border border-slate-700 rounded-xl overflow-hidden shadow-2xl relative flex flex-col\">\r\n                <div className=\"flex items-center gap-3 p-4 border-b border-slate-800\">\r\n                    <Search className=\"w-5 h-5 text-slate-500\" />\r\n                    <input\r\n                        ref={inputRef}\r\n                        type=\"text\"\r\n                        placeholder=\"Type a command or search...\"\r\n                        className=\"bg-transparent border-none outline-none text-slate-200 placeholder:text-slate-600 flex-1 font-mono text-sm\"\r\n                        value={query}\r\n                        onChange={(e) => {\r\n                            setQuery(e.target.value);\r\n                            setSelectedIndex(0);\r\n                        }}\r\n                    />\r\n                    <div className=\"flex gap-1\">\r\n                        <kbd className=\"px-1.5 py-0.5 bg-slate-800 border border-slate-700 rounded text-[10px] text-slate-400 font-sans\">ESC</kbd>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"max-h-[300px] overflow-y-auto p-2\">\r\n                    {results.length === 0 ? (\r\n                        <div className=\"p-4 text-center text-slate-500 text-xs font-mono\">No results found.</div>\r\n                    ) : (\r\n                        results.map((item, index) => (\r\n                            <button\r\n                                key={item.id}\r\n                                onClick={() => handleSelect(item)}\r\n                                className={`\r\n                                    w-full text-left px-3 py-2 rounded flex items-center justify-between group\r\n                                    ${index === selectedIndex ? 'bg-indigo-600/20 text-indigo-300' : 'text-slate-400 hover:bg-slate-800/50'}\r\n                                `}\r\n                            >\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <item.icon className={`w-4 h-4 ${index === selectedIndex ? 'text-indigo-400' : 'text-slate-600'}`} />\r\n                                    <span className={`text-sm ${item.type === 'ITEM' && 'font-mono'}`}>\r\n                                        {item.label}\r\n                                    </span>\r\n                                </div>\r\n\r\n                                {item.type === 'ITEM' && (\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <span\r\n                                            className=\"text-[10px] uppercase font-bold px-1.5 py-0.5 rounded bg-slate-950\"\r\n                                            style={{ color: item.rarity?.hex }}\r\n                                        >\r\n                                            {item.rarity?.name}\r\n                                        </span>\r\n                                        {item.isOwned ? (\r\n                                            <span className=\"text-[10px] text-emerald-500\">OWNED</span>\r\n                                        ) : (\r\n                                            <span className=\"text-[10px] text-slate-600\">LOCKED</span>\r\n                                        )}\r\n                                    </div>\r\n                                )}\r\n                                {item.type === 'NAV' && (\r\n                                    <ArrowRight className=\"w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity\" />\r\n                                )}\r\n                            </button>\r\n                        ))\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\components\\ExpeditionConsole.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\spritescavenger\\src\\components\\ExpeditionConsole.tsx:18:13\n  16 |         if (isActive) {\n  17 |             const percentage = ((totalDuration - timeLeft) / totalDuration) * 100;\n> 18 |             setProgress(percentage);\n     |             ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  19 |         } else {\n  20 |             setProgress(0);\n  21 |         }","line":18,"column":13,"nodeType":null,"endLine":18,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\r\nimport { Play, Cpu } from \"lucide-react\";\r\n\r\ninterface ExpeditionConsoleProps {\r\n    isActive: boolean;\r\n    timeLeft: number;\r\n    totalDuration: number;\r\n    onStart: () => void;\r\n    onOpenShop: () => void;\r\n}\r\n\r\nexport default function ExpeditionConsole({ isActive, timeLeft, totalDuration, onStart, onOpenShop }: ExpeditionConsoleProps) {\r\n    const [progress, setProgress] = useState(0);\r\n\r\n    useEffect(() => {\r\n        if (isActive) {\r\n            const percentage = ((totalDuration - timeLeft) / totalDuration) * 100;\r\n            setProgress(percentage);\r\n        } else {\r\n            setProgress(0);\r\n        }\r\n    }, [isActive, timeLeft, totalDuration]);\r\n\r\n    return (\r\n        <div className=\"w-full max-w-md mx-auto p-4\">\r\n            <div className=\"bg-slate-800 rounded-lg p-6 border border-slate-700 shadow-xl relative overflow-hidden\">\r\n                {isActive ? (\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"flex justify-between items-end text-slate-300\">\r\n                            <span className=\"text-xs uppercase tracking-widest animate-pulse\">Scanning Sector...</span>\r\n                            <span className=\"font-mono text-lg text-emerald-400\">{timeLeft}s</span>\r\n                        </div>\r\n\r\n                        <div className=\"h-4 bg-slate-900 rounded-full overflow-hidden border border-slate-600\">\r\n                            <div\r\n                                className=\"h-full bg-emerald-500 transition-all duration-200 ease-linear\"\r\n                                style={{ width: `${progress}%` }}\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-4 gap-1 mt-2\">\r\n                            {[...Array(4)].map((_, i) => (\r\n                                <div key={i} className={`h-1 rounded-sm ${i / 4 < progress / 100 ? 'bg-emerald-500/50' : 'bg-slate-700'}`} />\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"text-center space-y-4\">\r\n                        <div className=\"space-y-1\">\r\n                            <h2 className=\"text-slate-100 font-bold text-lg\">System Idle</h2>\r\n                            <p className=\"text-slate-400 text-sm\">Ready to initialize storage retrieval sequence.</p>\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={onStart}\r\n                            className=\"w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 rounded shadow-lg shadow-indigo-900/20 active:translate-y-0.5 transition-all flex items-center justify-center gap-2 group\"\r\n                        >\r\n                            <Play className=\"w-5 h-5 fill-current group-hover:scale-110 transition-transform\" />\r\n                            START EXPEDITION\r\n                        </button>\r\n\r\n                        <button\r\n                            onClick={onOpenShop}\r\n                            className=\"w-full bg-slate-900 hover:bg-slate-700 border border-slate-600 text-slate-300 font-bold py-2 rounded transition-all flex items-center justify-center gap-2\"\r\n                        >\r\n                            <Cpu className=\"w-4 h-4\" />\r\n                            HARDWARE LAB\r\n                        </button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\components\\Forge.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'addToInventory' is assigned a value but never used.","line":7,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\r\nimport { useGame } from \"@/context/GameContext\";\r\nimport { Flame, ArrowRight } from \"lucide-react\";\r\nimport { getRarity } from \"@/utils/rarity\";\r\n\r\nexport default function Forge() {\r\n    const { inventory, addToInventory, burnItems } = useGame(); // Removed unused bits/addBits for now if not used\r\n    const [selectedItems, setSelectedItems] = useState<string[]>([]);\r\n\r\n    // Simplification: Auto-select 10 duplicates for user? Or manual selection?\r\n    // Manual selection is tedious for 10 items.\r\n    // Let's implement \"Auto-Fill\" for UX.\r\n\r\n    const handleAutoFill = (rarityName: string) => {\r\n        // Collect up to 10 items of this rarity\r\n        // Prefer items that have high duplicate counts, but inventory is just an array of slugs.\r\n        // We find slugs that appear multiple times or just any slugs?\r\n        // \"Up-Cycling\" usually implies burning trash.\r\n\r\n        // Find all items of rarity\r\n        const candidates = inventory.filter(slug => getRarity(slug).name === rarityName);\r\n        // Take up to 10\r\n        setSelectedItems(candidates.slice(0, 10));\r\n    };\r\n\r\n    const handleForge = () => {\r\n        if (selectedItems.length !== 10) return;\r\n\r\n        // Cost? 50 Bits for Common->Uncommon.\r\n        // We assume burnItems handles persistence.\r\n        burnItems(selectedItems);\r\n\r\n        // Reward: 1 Random Item of next tier?\r\n        // We don't have a specific \"Uncommon\" pool easily accessible without scanning masterCollection.\r\n        // For MVP Phase 3 simplicity: Give a precise \"Uncommon Mystery Box\" item...\r\n        // OR: Just generate a random item from the pool and ensure it's Uncommon. This is easier.\r\n        // However, technically we should check cost.\r\n        // Let's assume cost is handled or we add 'removeBits' to context. (Not added yet).\r\n        // Let's just do free forge for now or valid if Bits implement 'remove' via addBits(-50).\r\n        // addBits(-50);\r\n\r\n        // Generate Reward\r\n        // Placeholder: We need a \"Generator\" utility eventually.\r\n        // For now, let's just emit a success event or use a known slug if available,\r\n        // or just let the user \"discover\" something next expedition.\r\n        // Better: Grant a specific \"Forged Alloy\" item or similar if we don't assume pool access easily.\r\n        // But wait, we can just call `generateLoot` logic? No, inaccessible.\r\n\r\n        // Solution: Just clear selection for now and show alert.\r\n        setSelectedItems([]);\r\n        alert(\"Forge Complete! (Placeholder: You would receive an item here)\");\r\n    };\r\n\r\n    return (\r\n        <div className=\"w-full max-w-4xl mx-auto p-4 pb-20\">\r\n            <div className=\"bg-slate-900 border border-slate-700 rounded-xl p-6 relative\">\r\n\r\n                <div className=\"flex items-center gap-3 mb-8\">\r\n                    <div className=\"w-12 h-12 bg-orange-600 rounded-full flex items-center justify-center animate-pulse\">\r\n                        <Flame className=\"text-white w-6 h-6\" />\r\n                    </div>\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-bold text-slate-100\">The Forge</h2>\r\n                        <p className=\"text-slate-400 text-sm\">Burn 10 items to forge a higher rarity.</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-8\">\r\n                    <div className=\"bg-slate-800 p-4 rounded-lg border border-slate-700\">\r\n                        <h3 className=\"text-slate-300 font-bold mb-4\">Crucible ({selectedItems.length}/10)</h3>\r\n                        <div className=\"grid grid-cols-5 gap-2 h-32 content-start overflow-y-auto\">\r\n                            {selectedItems.map((slug, i) => (\r\n                                <div key={i} className=\"w-8 h-8 bg-slate-700 rounded border border-slate-600\" title={slug}>\r\n                                    {/* Img placeholder */}\r\n                                </div>\r\n                            ))}\r\n                            {[...Array(10 - selectedItems.length)].map((_, i) => (\r\n                                <div key={`empty-${i}`} className=\"w-8 h-8 bg-slate-900/50 rounded border border-slate-800 border-dashed\" />\r\n                            ))}\r\n                        </div>\r\n                        <button\r\n                            onClick={() => handleAutoFill('Common')}\r\n                            className=\"mt-4 text-xs text-indigo-400 hover:text-indigo-300 underline\"\r\n                        >\r\n                            Auto-Fill Commons\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-col items-center justify-center gap-4\">\r\n                        <ArrowRight className=\"text-slate-600\" />\r\n                        <div className=\"w-24 h-24 bg-slate-900 rounded-xl border-2 border-slate-700 border-dashed flex items-center justify-center\">\r\n                            <span className=\"text-4xl\">?</span>\r\n                        </div>\r\n                        <button\r\n                            onClick={handleForge}\r\n                            disabled={selectedItems.length !== 10}\r\n                            className={`\r\n                                w-full py-3 rounded font-bold transition-all\r\n                                ${selectedItems.length === 10\r\n                                    ? 'bg-orange-600 hover:bg-orange-500 text-white shadow-lg shadow-orange-900/50'\r\n                                    : 'bg-slate-800 text-slate-500'\r\n                                }\r\n                            `}\r\n                        >\r\n                            FORGE\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\components\\Header.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used.","line":1,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":28},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'Image' is not defined.","line":29,"column":26,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":29,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Trophy, Coins, Zap, Settings } from \"lucide-react\";\r\nimport { useGame } from \"@/context/GameContext\";\r\nimport masterCollection from \"@/data/master-collection.json\";\r\n\r\ninterface HeaderProps {\r\n    onSettingsClick: (tab?: string) => void;\r\n    activeTab: string;\r\n}\r\n\r\nexport default function Header({ onSettingsClick, activeTab }: HeaderProps) {\r\n    const { inventory, bits, xp, level } = useGame();\r\n\r\n    const totalItems = Object.values(masterCollection).flat().length;\r\n    const uniqueItems = new Set(inventory).size;\r\n\r\n    const progress = (xp / nextLevelXp) * 100;\r\n\r\n    return (\r\n        <header className=\"fixed top-0 left-0 right-0 h-16 bg-slate-900 border-b border-slate-800 flex items-center justify-between px-4 z-50\">\r\n            <div className=\"flex items-center gap-4\">\r\n                {/* Identity / Level */}\r\n                <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center relative overflow-hidden group border border-indigo-400/30\">\r\n                        {/* Progress Fill */}\r\n                        <div\r\n                            className=\"absolute bottom-0 left-0 right-0 bg-teal-400/20 transition-all duration-1000 ease-out\"\r\n                            style={{ height: `${progress}%` }}\r\n                        />\r\n                        <Image\r\n                            src=\"/icon.png\"\r\n                            alt=\"Logo\"\r\n                            width={24}\r\n                            height={24}\r\n                            className=\"relative z-10 rounded-sm\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <h1 className=\"font-bold text-slate-100 leading-tight\">SPRITE<span className=\"text-indigo-500\">SCAVENGER</span></h1>\r\n                        <p className=\"text-[10px] text-slate-400 font-mono\">Lvl.{level} <span className=\"text-slate-600\">|</span> {Math.floor(xp)}/{nextLevelXp} XP</p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Desktop/Tablet Nav */}\r\n                <nav className=\"hidden md:flex items-center gap-1\">\r\n                    <button\r\n                        onClick={() => onSettingsClick('terminal')}\r\n                        className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-colors ${activeTab === 'terminal' ? 'bg-indigo-600 text-white' : 'hover:bg-slate-800 text-slate-400 hover:text-white'}`}\r\n                    >\r\n                        TERMINAL\r\n                    </button>\r\n                    <button\r\n                        onClick={() => onSettingsClick('lab')}\r\n                        className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-colors ${activeTab === 'lab' ? 'bg-indigo-600 text-white' : 'hover:bg-slate-800 text-slate-400 hover:text-white'}`}\r\n                    >\r\n                        LAB\r\n                    </button>\r\n                    <button\r\n                        onClick={() => onSettingsClick('forge')}\r\n                        className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-colors ${activeTab === 'forge' ? 'bg-indigo-600 text-white' : 'hover:bg-slate-800 text-slate-400 hover:text-white'}`}\r\n                    >\r\n                        FORGE\r\n                    </button>\r\n                    <button\r\n                        onClick={() => onSettingsClick('database')}\r\n                        className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-colors ${activeTab === 'database' ? 'bg-indigo-600 text-white' : 'hover:bg-slate-800 text-slate-400 hover:text-white'}`}\r\n                    >\r\n                        DATABASE\r\n                    </button>\r\n                </nav>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-4\">\r\n                <div className=\"hidden sm:flex flex-col items-end\">\r\n                    <div className=\"flex items-center gap-1 text-emerald-400\">\r\n                        <Trophy className=\"w-3 h-3\" />\r\n                        <span className=\"font-mono text-sm leading-none\">{uniqueItems} / {totalItems}</span>\r\n                    </div>\r\n                    <span className=\"text-[10px] text-slate-500 uppercase tracking-wider\">Collection</span>\r\n                </div>\r\n\r\n                <div className=\"flex flex-col items-end\">\r\n                    <div className=\"flex items-center gap-1 text-amber-400\">\r\n                        <Coins className=\"w-3 h-3\" />\r\n                        <span className=\"font-mono text-sm leading-none\">{bits}</span>\r\n                    </div>\r\n                    <span className=\"text-[10px] text-slate-500 uppercase tracking-wider\">Bits</span>\r\n                </div>\r\n\r\n                {/* Actions */}\r\n                <div className=\"flex items-center gap-2\">\r\n                    <button\r\n                        onClick={() => {/* Trigger palette? We need prop for this. Shortcuts work for now. */ }}\r\n                        className=\"hidden md:flex items-center gap-2 px-2 py-1.5 bg-slate-900 border border-slate-700 rounded text-xs text-slate-500 hover:text-slate-300 transition-colors pointer-events-none\"\r\n                    >\r\n                        <span className=\"text-[10px] font-mono\">CMD+K</span>\r\n                    </button>\r\n                    <button\r\n                        onClick={() => onSettingsClick('settings')}\r\n                        className=\"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors\"\r\n                        title=\"Settings\"\r\n                    >\r\n                        <Settings className=\"w-5 h-5\" />\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </header>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\components\\LootReveal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\components\\SettingsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\components\\Shop.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\context\\GameContext.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":84,"column":5,"severity":1,"nodeType":null,"fix":{"range":[2951,3006],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"\"use client\";\r\n\r\nimport React, { createContext, useContext, useEffect, useState } from \"react\";\r\n\r\ninterface GameState {\r\n  inventory: string[];\r\n  wallet: number; // Legacy\r\n  bits: number;\r\n  xp: number;\r\n  level: number;\r\n  upgrades: {\r\n    speed: number;\r\n    multithread: number;\r\n    luck: number;\r\n  };\r\n  unlockedBiomes: string[];\r\n  activeBiome: string;\r\n  expeditionStartTime: number | null;\r\n}\r\n\r\ninterface GameContextType extends GameState {\r\n  addToInventory: (items: string[]) => void;\r\n  addBits: (amount: number) => void;\r\n  addXp: (amount: number) => void;\r\n  buyUpgrade: (type: 'speed' | 'multithread' | 'luck', cost: number) => boolean;\r\n  unlockBiome: (biomeId: string, cost: number) => boolean;\r\n  setActiveBiome: (biomeId: string) => void;\r\n  burnItems: (slugs: string[]) => void; // Core for Forge\r\n  startExpedition: () => void;\r\n  endExpedition: () => void;\r\n  exportSave: () => string;\r\n  importSave: (base64: string) => boolean;\r\n  isLoading: boolean;\r\n  pendingLoot: string[] | null;\r\n  setPendingLoot: (items: string[] | null) => void;\r\n}\r\n\r\nconst GameContext = createContext<GameContextType | undefined>(undefined);\r\n\r\nconst SAVE_KEY = \"sprite_scavenger_save\";\r\nconst DEFAULT_UPGRADES = { speed: 1, multithread: 1, luck: 1 };\r\nconst DEFAULT_BIOMES = ['Depths'];\r\nconst DEFAULT_ACTIVE_BIOME = 'Depths';\r\n\r\nexport function GameProvider({ children }: { children: React.ReactNode }) {\r\n  const [inventory, setInventory] = useState<string[]>([]);\r\n  const [wallet, setWallet] = useState<number>(0);\r\n  const [bits, setBits] = useState<number>(0);\r\n  const [xp, setXp] = useState<number>(0);\r\n  const [upgrades, setUpgrades] = useState(DEFAULT_UPGRADES);\r\n\r\n  const [unlockedBiomes, setUnlockedBiomes] = useState<string[]>(DEFAULT_BIOMES);\r\n  const [activeBiome, setActiveBiome] = useState<string>(DEFAULT_ACTIVE_BIOME);\r\n\r\n  const [expeditionStartTime, setExpeditionStartTime] = useState<number | null>(\r\n    null\r\n  );\r\n  const [pendingLoot, setPendingLoot] = useState<string[] | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  // Derived Level: Level = floor(sqrt(xp / 100)) + 1\r\n  // XP 0 = Lvl 1. XP 100 = Lvl 2. XP 400 = Lvl 3.\r\n  const level = Math.floor(Math.sqrt(xp / 100)) + 1;\r\n\r\n  // Load from LocalStorage\r\n  useEffect(() => {\r\n    const saved = localStorage.getItem(SAVE_KEY);\r\n    if (saved) {\r\n      try {\r\n        const parsed = JSON.parse(saved);\r\n        setInventory(parsed.inventory || []);\r\n        setWallet(parsed.wallet || 0);\r\n        setBits(parsed.bits || 0);\r\n        setXp(parsed.xp || 0);\r\n        setUpgrades(parsed.upgrades || DEFAULT_UPGRADES);\r\n        setUnlockedBiomes(parsed.unlockedBiomes || DEFAULT_BIOMES);\r\n        setActiveBiome(parsed.activeBiome || DEFAULT_ACTIVE_BIOME);\r\n        setExpeditionStartTime(parsed.expeditionStartTime || null);\r\n      } catch (e) {\r\n        console.error(\"Failed to load save\", e);\r\n      }\r\n    }\r\n    setIsLoading(false);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  // Save to LocalStorage\r\n  // Ref to hold latest state for the interval (avoids resetting timer)\r\n  const stateRef = React.useRef<Partial<GameState>>({});\r\n\r\n  useEffect(() => {\r\n    stateRef.current = {\r\n      inventory,\r\n      wallet,\r\n      bits,\r\n      xp,\r\n      upgrades,\r\n      unlockedBiomes,\r\n      activeBiome,\r\n      expeditionStartTime,\r\n    };\r\n  }, [inventory, wallet, bits, xp, upgrades, unlockedBiomes, activeBiome, expeditionStartTime]);\r\n\r\n  // Save to LocalStorage periodically (Debounced/Throttled)\r\n  useEffect(() => {\r\n    if (isLoading) return;\r\n\r\n    const interval = setInterval(() => {\r\n      localStorage.setItem(SAVE_KEY, JSON.stringify(stateRef.current));\r\n    }, 2000); // Save every 2 seconds max\r\n\r\n    return () => clearInterval(interval);\r\n  }, [isLoading]);\r\n\r\n  const addToInventory = (items: string[]) => {\r\n    setInventory((prev) => [...prev, ...items]);\r\n  };\r\n\r\n  const addBits = (amount: number) => {\r\n    setBits((prev) => prev + amount);\r\n  };\r\n\r\n  const addXp = (amount: number) => {\r\n    setXp((prev) => prev + amount);\r\n  };\r\n\r\n  const buyUpgrade = (type: 'speed' | 'multithread' | 'luck', cost: number) => {\r\n    if (bits >= cost) {\r\n      setBits(prev => prev - cost);\r\n      setUpgrades(prev => ({\r\n        ...prev,\r\n        [type]: prev[type] + 1\r\n      }));\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  const unlockBiome = (biomeId: string, cost: number) => {\r\n    if (bits >= cost && !unlockedBiomes.includes(biomeId)) {\r\n      setBits(prev => prev - cost);\r\n      setUnlockedBiomes(prev => [...prev, biomeId]);\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  const burnItems = (slugs: string[]) => {\r\n    setInventory(prev => {\r\n      const newInv = [...prev];\r\n      slugs.forEach(slug => {\r\n        const idx = newInv.indexOf(slug);\r\n        if (idx > -1) newInv.splice(idx, 1);\r\n      });\r\n      return newInv;\r\n    });\r\n  };\r\n\r\n  const startExpedition = () => {\r\n    setExpeditionStartTime(Date.now());\r\n  };\r\n\r\n  const endExpedition = () => {\r\n    setExpeditionStartTime(null);\r\n  };\r\n\r\n  const exportSave = () => {\r\n    const state: GameState = {\r\n      inventory,\r\n      wallet,\r\n      bits,\r\n      xp,\r\n      level,\r\n      upgrades,\r\n      unlockedBiomes,\r\n      activeBiome,\r\n      expeditionStartTime\r\n    };\r\n    return btoa(JSON.stringify(state));\r\n  };\r\n\r\n  const importSave = (base64: string) => {\r\n    try {\r\n      const json = atob(base64);\r\n      const parsed = JSON.parse(json);\r\n\r\n      if (!parsed.inventory || !parsed.upgrades) return false;\r\n\r\n      setInventory(parsed.inventory);\r\n      setWallet(parsed.wallet || 0);\r\n      setBits(parsed.bits || 0);\r\n      setXp(parsed.xp || 0);\r\n      setUpgrades(parsed.upgrades);\r\n      setUnlockedBiomes(parsed.unlockedBiomes || DEFAULT_BIOMES);\r\n      setActiveBiome(parsed.activeBiome || DEFAULT_ACTIVE_BIOME);\r\n      setExpeditionStartTime(parsed.expeditionStartTime || null);\r\n      return true;\r\n    } catch (e) {\r\n      console.error(\"Import failed\", e);\r\n      return false;\r\n    }\r\n  };\r\n\r\n\r\n\r\n  return (\r\n    <GameContext.Provider\r\n      value={{\r\n        inventory,\r\n        wallet,\r\n        bits,\r\n        xp,\r\n        level,\r\n        upgrades,\r\n        unlockedBiomes,\r\n        activeBiome,\r\n        expeditionStartTime,\r\n        addToInventory,\r\n        addBits,\r\n        addXp,\r\n        buyUpgrade,\r\n        unlockBiome,\r\n        setActiveBiome,\r\n        burnItems,\r\n        startExpedition,\r\n        endExpedition,\r\n        exportSave,\r\n        importSave,\r\n        isLoading,\r\n        pendingLoot,\r\n        setPendingLoot,\r\n      }}\r\n    >\r\n      {children}\r\n    </GameContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useGame() {\r\n  const context = useContext(GameContext);\r\n  if (context === undefined) {\r\n    throw new Error(\"useGame must be used within a GameProvider\");\r\n  }\r\n  return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\data\\biomes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\hooks\\useExpedition.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\hooks\\useExpedition.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\spritescavenger\\src\\hooks\\useExpedition.ts:83:13\n  81 |     useEffect(() => {\n  82 |         if (!expeditionStartTime) {\n> 83 |             setTimeLeft(0);\n     |             ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  84 |         }\n  85 |     }, [expeditionStartTime]);\n  86 |","line":83,"column":13,"nodeType":null,"endLine":83,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'setLoot'. Either include it or remove the dependency array.","line":106,"column":8,"nodeType":"ArrayExpression","endLine":106,"endColumn":53,"suggestions":[{"desc":"Update the dependencies array to be: [expeditionStartTime, duration, generateLoot, setLoot]","fix":{"range":[3865,3910],"text":"[expeditionStartTime, duration, generateLoot, setLoot]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState, useCallback } from \"react\";\r\nimport { useGame } from \"@/context/GameContext\";\r\nimport masterCollection from \"@/data/master-collection.json\";\r\nimport { getRarity } from \"@/utils/rarity\";\r\nimport { BIOMES } from \"@/data/biomes\";\r\n\r\nconst BASE_DURATION = 30; // seconds\r\nconst BASE_ITEMS = 3;\r\n\r\nexport function useExpedition() {\r\n    const {\r\n        expeditionStartTime,\r\n        startExpedition: startContextExpedition,\r\n        endExpedition: endContextExpedition,\r\n        addToInventory,\r\n        addBits,\r\n        addXp,\r\n        inventory,\r\n        upgrades,\r\n        activeBiome,\r\n        pendingLoot: loot, // Alias to keep existing code working\r\n        setPendingLoot: setLoot // Alias\r\n    } = useGame();\r\n\r\n    // Calculate duration based on Overclock speed\r\n    const duration = Math.floor(BASE_DURATION * Math.pow(0.9, upgrades.speed - 1));\r\n\r\n    // Initialize timeLeft lazily\r\n    const [timeLeft, setTimeLeft] = useState(() => {\r\n        if (!expeditionStartTime) return 0;\r\n        const now = Date.now();\r\n        const elapsedSeconds = Math.floor((now - expeditionStartTime) / 1000);\r\n        return Math.max(0, duration - elapsedSeconds);\r\n    });\r\n\r\n    // Local loot state removed in favor of Context\r\n\r\n\r\n    const generateLoot = useCallback(() => {\r\n        // Phase 3: Filter categories by Active Biome\r\n        const currentBiomeDef = BIOMES.find(b => b.id === activeBiome) || BIOMES[0];\r\n        const allowedCategories = currentBiomeDef.categories;\r\n\r\n        // Multithreading affects loot count\r\n        const numItems = BASE_ITEMS + (upgrades.multithread - 1);\r\n\r\n        const newLoot: string[] = [];\r\n\r\n        // Safety check if biome categories don't exist in masterCollection\r\n        const validCategories = allowedCategories.filter(cat => Object.keys(masterCollection).includes(cat));\r\n\r\n        // If fallback needed (e.g. data missing), default to all\r\n        const categoriesToUse = validCategories.length > 0 ? validCategories : Object.keys(masterCollection);\r\n\r\n        for (let i = 0; i < numItems; i++) {\r\n            const randomCategory = categoriesToUse[Math.floor(Math.random() * categoriesToUse.length)];\r\n            // @ts-expect-error JSON typing\r\n            const items = masterCollection[randomCategory] as string[];\r\n            if (items && items.length > 0) {\r\n                let pickedItem = items[Math.floor(Math.random() * items.length)];\r\n\r\n                // Lucky CPU Logic\r\n                if (upgrades.luck > 1) {\r\n                    const rarity = getRarity(pickedItem);\r\n                    if (rarity.name === 'Common') {\r\n                        if (Math.random() < 0.2 * (upgrades.luck - 1)) {\r\n                            const retryItem = items[Math.floor(Math.random() * items.length)];\r\n                            pickedItem = retryItem;\r\n                        }\r\n                    }\r\n                }\r\n                newLoot.push(pickedItem);\r\n            }\r\n        }\r\n        return newLoot;\r\n    }, [upgrades.multithread, upgrades.luck, activeBiome]);\r\n\r\n    // Reset timeLeft when expedition stops\r\n    useEffect(() => {\r\n        if (!expeditionStartTime) {\r\n            setTimeLeft(0);\r\n        }\r\n    }, [expeditionStartTime]);\r\n\r\n    // Timer Logic\r\n    useEffect(() => {\r\n        if (!expeditionStartTime) return;\r\n\r\n\r\n        const interval = setInterval(() => {\r\n            const now = Date.now();\r\n            const elapsedSeconds = Math.floor((now - expeditionStartTime) / 1000);\r\n            const remaining = Math.max(0, duration - elapsedSeconds);\r\n\r\n            setTimeLeft(remaining);\r\n\r\n            if (remaining === 0) {\r\n                clearInterval(interval);\r\n                setLoot(prev => prev || generateLoot());\r\n            }\r\n        }, 200);\r\n\r\n        return () => clearInterval(interval);\r\n    }, [expeditionStartTime, duration, generateLoot]);\r\n\r\n    const isActive = expeditionStartTime !== null && timeLeft > 0;\r\n    const isFinished = expeditionStartTime !== null && timeLeft === 0;\r\n\r\n    const start = () => {\r\n        setLoot(null);\r\n        startContextExpedition();\r\n    };\r\n\r\n    const claim = () => {\r\n        if (loot) {\r\n            const newItems: string[] = [];\r\n            let totalBits = 0;\r\n            let totalXp = 0;\r\n\r\n            loot.forEach(slug => {\r\n                const rarity = getRarity(slug);\r\n\r\n                // XP Logic: 10/50/500 based on rarity tiers?\r\n                // Tiers: Common(1), Uncommon(5), Rare(25), Epic(100), Legendary(500) - based on Value.\r\n                // Let's use specific XP values as requested: Common=10, Rare=50, Legendary=500.\r\n                // Mapping: Common=10, Uncommon=25, Rare=50, Epic=200, Legendary=500.\r\n                let xpValue = 10;\r\n                if (rarity.name === 'Uncommon') xpValue = 25;\r\n                if (rarity.name === 'Rare') xpValue = 50;\r\n                if (rarity.name === 'Epic') xpValue = 200;\r\n                if (rarity.name === 'Legendary') xpValue = 500;\r\n\r\n                totalXp += xpValue;\r\n\r\n                if (inventory.includes(slug) || newItems.includes(slug)) {\r\n                    // Duplicate!\r\n                    totalBits += rarity.value;\r\n                } else {\r\n                    newItems.push(slug);\r\n                }\r\n            });\r\n\r\n            if (newItems.length > 0) addToInventory(newItems);\r\n            if (totalBits > 0) addBits(totalBits);\r\n            if (totalXp > 0) addXp(totalXp);\r\n\r\n            // Level Up Care Package logic could be handled in Context or useEffect, \r\n            // but simple additive XP here is fine. The UI will reflect level change.\r\n\r\n            setLoot(null);\r\n            endContextExpedition();\r\n        }\r\n    };\r\n\r\n    return {\r\n        timeLeft,\r\n        isActive,\r\n        isFinished,\r\n        loot,\r\n        start,\r\n        claim,\r\n        totalDuration: duration\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\utils\\lookup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\utils\\rarity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\views\\CollectionView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\views\\ExpeditionView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\views\\ForgeView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\src\\views\\LabView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\spritescavenger\\vitest.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
